%%==================================================
%% chapter01.tex for SJTU Master Thesis
%% based on CASthesis
%% modified by wei.jianwen@gmail.com
%% version: 0.3a
%% Encoding: UTF-8
%% last update: Dec 5th, 2010
%%==================================================

%\bibliographystyle{sjtu2} %[此处用于每章都生产参考文献]
\chapter{这是什么}
\label{chap:what}
\cite{mcu}
这是上海交通大学硕士学位学位论文~\LaTeX~模板，当前版本是~\version。
这是上海交大非官方出品的的~\LaTeX~硕士论文模板，是大家根据研究生院学位论文格式要求制作出的模板。

\section{模板的来历}

笔者不才，占了水源~TeX\_LaTeX~版版二的位置
\footnote{笔者11月初去北京参加IETF79，沾了沾仙气，结果错过了版上述职时间，目前被撤职。等缓过来后仍会卷土重来。}
。因自己对~\TeX/\LaTeX~了解有限，一直没能做出一个使用“文档类”(documentclass)的学位论文模板。
正当我为这个事情发愁的时候，事情出现了重大转机：
一位交大物理系的热心同学在~CASthesis~文档类的基础上制作了交大博士学位论文~\LaTeX~模板。
借此东风，将该模板稍作修整后，我把它发在版上，供大家使用。
目前，交大博士论文~\LaTeX~模板工作良好，希望能使更多同学受益。

最近，又有同学提出希望能制作出交大硕士学位论文模板。
我参考了教务处对研究生学位论文格式的要求，在``博士学位论文~\LaTeX~模板''的基础上，制作了这个``硕士学位论文~\LaTeX~模板''。

但是，大家也反映，使用~CJK--\LaTeX~仍存在不便之处。在~Linux~下使用~CJK~模板的同学，都有过搭建~CJK~环境的``恐怖经历''，并且因此放弃使用模板的也有。鉴于~\XeTeX~日渐成熟，它处理~UTF-8~编码文字的功夫令笔者惊叹，所以决定把模板移植到~\XeTeX~上。这里面很大一部分工作是~William Wang~完成的，在此向他表示感谢。

欢迎大家使用交大硕士学位论文~\LaTeX~模板，有任何问题或者建议请到~TeX\_LaTeX~版发贴讨论。
由于时间关系，我无法通过邮件提供~\LaTeX~支持，但是你可以通过邮件向我报告模板中的~Bugs，邮件主题中请加``latex''
\footnote{笔者的联系方式是：\href{mailto:wei.jianwen@gmail.com}{wei.jianwen@gmail.com}。最初那位制作模板的同学——也就是那位热心的物理系同学，留下的联系方式是\href{mailto:yang_tao@sjtu.edu.cn}{yang\_tao@sjtu.edu.cn}，不过似乎联系不上。笔者目前负责修正模板中与学校格式要求不符的地方，以及模板的Bug。一般的~\LaTeX~问题，仍推荐到版上讨论。}。

再次感谢那位物理系的热心同学和~William Wang~的无私帮助！

\section{模板说明}
\label{sec:fastguide}

\subsection{模板特性}
\label{sec:features}

这个模板基于~CASthesis--0.1j~文档类，中文解决方案是~\XeTeX/\LaTeX~。
参考文献建议使用~BibTeX~管理，可以生成符合国标~GBT7714~风格的参考文献列表。
模板在~Windows~和~Linux~下测试通过，更详细的系统要求请参考\ref{sec:requirements}。

模板的外观表现和功能都放在~sjtumaster-xetex.cls~和~sjtumaster-xetex.cfg~中，在对外观进行细微调整时，只需要更新这两个文件，不需要对.tex源文件做修改。
这也给模板更新带来了极大方便。

最后，给出一个列表，罗列一下这个模板的功能要点：

\begin{itemize}
\item 使用~\XeTeX~引擎处理中文；
\item 包含中文字符的源文件(.tex, .bib, .cfg)，编码都使用UTF-8；
\item 使用~BibTeX~管理参考文献。参考文献表现形式(格式)受~.bst~控制，方便在不同风格间切换，目前生成的列表符合国标GBT7714要求；
\item 可以直接插入EPS/PDF/JPG/PNG格式的图像，并且\emph{不需要}~bounding box~文件(.bb)。
\item 模板的格式受~sjtumater-xetex.cls~和~sjtumaster-xetex.cfg~控制，方便模板更新和模板修改。
\end{itemize}

\subsection{系统要求}
\label{sec:requirements}

要使用这个模板协助你完成研究生学位论文的创作，下面的条件必须满足：

\begin{itemize}
\item 操作系统字体目录中有~TeX Gyre Termes~西文的：Regular, Italic, Bold, Bold Italic~四种~OTF~字体\footnote{TeX Gyre Termes~字体可以从\href{http://www.gust.org.pl/projects/e-foundry/tex-gyre/termes}{http://www.gust.org.pl/projects/e-foundry/tex-gyre/termes}下载。我也附带了一份~TeX.Gyre.Termes.Fonts.zip~在模板中，解压缩到字体目录后用~fc-cache -fv~刷新即可，用~fc-list~应该能看到。}；
\item 操作系统字体目录中有~AdobeSongStd、AdobeKaitiStd、AdobeHeitiStd、AdobeFangsongStd~四款中文字体\footnote{Adobe~这四款中文~OTF~字体可以从~Adobe Reader~安装目录拿到。}；
\item \TeX~系统有~\XeTeX~引擎；
\item \TeX~系统有~ctex~宏包；
\item 你有使用~\LaTeX~的经验。
\end{itemize}

你可以试着编译模板文件夹中自带的~test.tex~文件，看看你的~\TeX~系统是否满足上面的要求：

\begin{verbatim}
xelatex test.tex
\end{verbatim}

如果编译出的~test.pdf~中能够：显示中英文内容、显示4幅图像、正确嵌入~AdobeSongStd~和~TeXGyreTermes~字体（通过PDF阅读器的“属性”查看）、并且看到了英文字符的连字(ligature)和\textsc{SmallCapital}特性，那么恭喜你，你的~\TeX~系统应该能够编译这个学位论文模板。

目前，我在手头的几个~\TeX~环境上都做过测试，TeXLive 2010和C\TeX 2.9、C\TeX 2.8都能够顺利编译。在你到版上抱怨模板不能工作前，请确定你的~\TeX~系统能够编译前面的~test.tex~文件。欢迎大家把编译的情况直接\href{mailto:wei.jianwen@gmail.com}{反馈}给我(但我并不能保证能解决问题)。来信的内就写你是否顺利编译模板、错误提示、操作系统版本、\TeX~系统版本、xunicode.sty~版本和fontspec.sty版本。
 
\subsection{模板文件布局}
\label{sec:layout}

\begin{lstlisting}[basicstyle=\small\ttfamily,caption={模板文件布局},label=layout,float,numbers=none]
  ├─ diss.tex
  ├── README.pdf
  ├── sjtumaster-xetex.cfg
  ├── sjtumaster-xetex.cls
  ├── body
  │   ├── abstract.tex
  │   ├── app1.tex
  │   ├── app2.tex
  │   ├── chapter01.tex
  │   ├── chapter02.tex
  │   ├── conclusion.tex
  │   ├── projects.tex
  │   ├── pub.tex
  │   ├── resume.tex
  │   ├── symbol.tex
  │   └── thanks.tex
  ├── figures
  │   └── chap2
  ├── from.gkb.to.utf8.txt
  ├── GBT7714-2005NLang.bst
  ├── Makefile
  ├── reference
  │   ├── chap1.bib
  │   └── chap2.bib
  ├── run.bat
  ├── run.sh
  └── test.tex
\end{lstlisting}

你拿到手的模板文件大致会包含代码\ref{layout}所列的文件，乍看起来还是挺令人头大的。
并且，这还是“干净”的时候，等到真正开始处理的时候，会冒出相当多的“中间文件”，这又会使情况变得更糟糕。
所以，有必要对这些文件做一些简要说明。
看完这部分以后，你应该发现，其实你要关心的文件类型并没有那么多。

\subsubsection{格式控制文件}
\label{sec:format}

格式控制文件控制着论文的表现形式，包括以下几个文件：
sjtumaster-xetex.cfg, sjtumaster-xetex.cls~和~GBT7714-2005NLang.bst。
其中，``.cfg''和``.cls''控制论文主体格式，``.bst''控制参考文献条目的格式，

一般用户最好``忽略''格式控制文件的存在，不要去碰它们。
有其他格式需要，欢迎到板上发贴。
对于因为擅自更改格式控制文件出现的问题，我一概不负责。{\large\smiley}

\subsubsection{主控文件~diss.tex}
\label{sec:disstex}

主控文件~diss.tex~的作用就是将你分散在多个文件中的内容``整合''成一篇完整的论文。
使用这个模板撰写学位论文时，你的学位论文内容和素材会被``拆散''到各个文件中：
譬如各章正文、各个附录、各章参考文献等等。
在~diss.tex~中通过``include''命令将论文的各个部分包含进来，从而形成一篇结构完成的论文。
封面页中的论文标题、作者等中英文信息，也是在~diss.tex~中填写。
部分可能会频繁修改的设置，譬如行间距、图片文件目录等，我也放在了diss.tex中。
你也可以在diss.tex中按照自己的需要引入一些的宏包
\footnote{我对宏包的态度是：只有当你需要在文档中使用那个宏包时，才需要在导言区中用~usepackage~引入该宏包。如若不然，通过usepackage引入一大堆不被用到的宏包，必然是一场灾难。由于一开始没有一致的设计目标，\LaTeX~的各宏包几乎都是独立发展起来的，因重定义命令导致的宏包冲突屡见不鲜。}
。

大致而言，在~diss.tex~中，大家只要留意把``章''一级的内容，以及各章参考文献内容包含进来就可以了。
需要注意，处理文档时所有的操作命令{}\cndash{}xelatex, bibtex等，都是作用在~diss.tex~上，而\emph{不是}后面这些``分散''的文件，请参考\ref{sec:process}小节。

\subsubsection{论文主体文件夹body}
\label{sec:thesisbody}

这一部分是论文的主体，是以``章''为单位划分的。

正文前部分(frontmatter)：中英文摘要(abstract.tex)。其他部分，诸如中英文封面、授权信息等，都是根据~diss.tex~所填的信息``画''好了，
不单独弄成文件。

正文部分(mainmatter)：自然就是各章内容~chapter\emph{xxx}.tex~了，这部分无法自动生成{\LARGE\Smiley}

正文后的部分(backmatter)：附录(app\emph{xx}.tex)；致谢(thuanks.tex)；攻读学位论文期间发表的学术论文目录(pub.tex)；个人简历(resume.tex)。
参考文献列表是``生成''的，也不作为一个单独的文件。另外，学校的硕士研究生学位论文模板中，也没有要求加入个人建立，所以我没有在~diss.tex~中引入resume.tex。

\subsubsection{图片文件夹~figures}
\label{sec:figuresdir}

figures~文件夹放置了需要插入文档中的图片文件(PNG/JPG/PDF/EPS)，建议按章再划分子目录。

\subsubsection{参考文献数据库文件夹~reference}
\label{sec:bibdir}

reference~文件夹放置的是各章``可能''会被引用的参考文献文件。
参考文献的元数据，例如作者、文献名称、年限、出版地等，会以一定的格式记录在纯文本文件.bib中。
最终的参考文献列表是BibTeX处理.bib后得到的，名为~diss.bbl。
将参考文献按章划分的一个好处是，可以在各章后生成独立的参考文献，不过，现在看来没有这个必要。
关于参考文献的管理，可以进一步参考第\ref{chap:example}章中的例子。

\subsection{如何使用}
\label{sec:process}

模板使用~\XeTeX~引擎提供的~xelatex~的命令处理，作用于“主控文档”diss.tex。并且，可以省略扩展名。完整的处理流程是：
\begin{enumerate}
\item[] xelatex -no-pdf -{}-interaction=nonstopmode diss
\item[] bibtex diss 
\item[] xelatex -no-pdf -{}-interaction=nonstopmode diss 
\item[] xelatex -{}-interaction=nonstopmode diss 
\end{enumerate}

运行bibtex的时候会提示一些错误，猜测是~{{\sc Bib}\TeX}~对UTF-8支持不充分，一般不影响最终结果。留意因为拼写错误导致的``找不到文献错误''即可。

加入~\verb|--interaction=nonstopmode|~参数是不让错误打断编译过程。\XeTeX~仍存在一些宏包兼容性问题，所以会产生一些莫名其妙的错误(通常是重定义错误)，而这些错误通常不会影响最终的编译结果\footnote{xunicode宏包就很蛋痛地重定义了几个数学符号，还有诸如$\backslash$nobreakspace命令}。
为方便使用，我把处理过程写到了run.sh(for Linux)和run.bat(for Windows)批处理文件中。更规范的应该是使用Makefile，可惜笔者功力不够，希望哪位高人把好用的Makefile补上。

基本处理流程就是这样，一些~\LaTeX~排版的小例子可以参考第二章。

\section{从~CJK-\LaTeX~迁移到~\XeTeX/\LaTeX}
\label{sec:whydvipdfm}

我习惯把v0.2a使用dvipdfmx编译的硕士学位论文模板称为``CJK-\LaTeX{}模板''，而这个使用\XeTeX{}引擎(xelatex程序)处理的模板则被称为``\XeTeX/\LaTeX{}模板''。
从CJK--LaTeX模板迁移到XeTeX\_LaTeX模板的好处有下：
\begin{enumerate}
\item[\large\smiley] 搭建~\XeTeX~环境比搭建CJK--\LaTeX~环境更容易；
\item[\large\smiley] 更简单的字体控制；
\item[\large\smiley] 完美支持PDF/EPS/PNG/JPG图片，不需要``.bb''文件；
\item[\large\smiley] 支持~OpenType~字体的复杂字型变化功能(通常只有字母字体才有，学术文章也暂时用不上)；
\end{enumerate}

当然，这也是有代价的。由于~\XeTeX~比较新，宏包兼容性仍不是很完美(\LaTeX~也存在这样的问题)，很多宏包仍然在“修正”，以便更好地协同工作。在我看来，使用这个XeTeX模板所必须付出的代价是：

\begin{enumerate}
\item[\large\frownie] 必须把你“古老的”~\TeX~系统更新为较新的版本。TeXLive 2010~和~CTeX 2.9~能够编译这份模板，而~TeXLive 2009~和~CTeX 2.8~对此则无能为力；
\item[\large\frownie] 需要一点点时间把你的~CJK-LaTeX~源文件转换为~XeTeX~源文件；
\end{enumerate}

第一条就看你如何取舍了，新系统通常意味着更好的兼容性，值得升级。而转换模板也不是什么特别困难的事情，可以这样完成：

\begin{enumerate}
\item 备份你要转换的源文件，以防你的工作成果丢失；
\item 将你原来的``.tex''和``.bib''文件"另存为"UTF-8编码的文件。iconv、vim、emacs、UEdit~等等工具都可以完成。WinEdt~对文件编码识别功能很差(到了v6.0还是如此)，不推荐作为字符编码转换工具；
\item 将``.tex''源文件中的以$\backslash$开始的~\LaTeX~命令，用\verb|~|将其与中文字符分开，否则与之相连的中文字符也被认为是命令的一部分，造成错误；
\item 将~diss.tex~导言区中的内容替换为~XeTeX~模板~diss.tex~导言区的内容；
\item 将你对原先导言区的修改，小心翼翼地``合并''到新的导言区中；
\item 使用~XeTeX~模板中的~GBT7714-2005NLang.bst~替换原有的bst文件，新的bst文件只是将字符编码转换为UTF--8。
\item 删除~bouding box~文件``.bb''；
\item 使用本文\ref{sec:process}介绍的方法，重新编译文档；
\end{enumerate}

\section{硕士学位论文格式的一些说明}
\label{sec:thesisformat}

所有关于研究生学位论文模板的要求，我参考的都是下面这个教务处的网址
\href{http://www.gs.sjtu.edu.cn/policy/fileShow.ahtml?id=130}{《上海交通大学研究生学位论文格式的统一要求 》}。

可惜，这个网址没有给出具体可用的“模板文件”。
并且，``要求''中的一些要求也不仅合理，譬如，公式和公式编号之前要用……连接，实现起来困难，看起来也不美观，从来没有人这样用，所以无视之。
师兄师姐的学位论文也是我可以参考的“范本”，尽管这些范本也不是很规范。
我希望制作出的这个学位论文模板尽可能符合教务处的要求，如果有任何建议，欢迎提出！

这个模板是为``双面打印''准备的，也就是说，迎面页总是奇数页，新的一章将从奇数页开始，``迎面页''和``背面页''(或者说奇数页和偶数页)的左右页眉是相互颠倒的，奇数页和偶数页的左右页边距也会被颠倒。通过双面打印得到的学位论文就像一本正常的书。

你可以将~diss.tex~中设定文档类的语句改为：

\begin{quote}
  {\scriptsize\verb+\documentclass[cs4size, a4paer, cs4size, oneside, openany]{sjtumaster-xetex}+}
\end{quote}

这样，就变成了适合“单面打印”的论文，新的一章可以从偶数页开始。

关于页眉页脚。奇数页页眉为：左边``上海交通大学硕士学位论文''，右边：``章节名''；偶数页页眉为：左边``上海交通大学硕士学位论文''，右边：``论文题目''。每一章的内容按照排书的习惯，均从奇数页开始。

教务处要求参考文献必须符合~GBT7714~风格，学校明确提出使用这个标准而不是自己拍脑袋想出别的做法，应该算是谢天谢地了。使用这个模板，结合BibTeX，可以很方便地生成符合GB标准的参考文献列表。

\section{模板更新说明}
\label{sec:update}

我希望这个模板能够成为大家完成学位论文的助手。
我会在一段时间内(一个月？一年？)，继续维护这个模板，修正其中的错误和不理想的地方。
我还计划向模板中添加常用的``例子''，譬如表格、公式、图片的排版，这也是我知识汇总的。

模板的版本号由这两部分构成：``数字''+``字母''，譬如第一个版本的版本号v0.1a。
当对模板的修改达到了我认为可以释放出一个新版本的时候，我会更新版本号，并将新版本放在版上。
版本号的变动分两种情况：

\begin{itemize}
\item 如果仅仅是增加模板中的例子，不对模板的格式控制文件做修改，那么版本号将在字母上增加，数字不变，例如，0.1a$\rightarrow$0.1b；
\item 如果对格式控制文件(sjtumaster-xetex.cls, sjtumaster-xetex.cfg, GBxxx.bst)做了修改，版本号将在数字上做变动，同时字母回归a，例如，0.1c$\rightarrow$0.2a。
\end{itemize}

至此，大家可以通过留意版本号的变化来判断模板更新的类型。
完整的更新记录可参考附录A.

不管怎么说，模板更新总是一件好事。
因为在对模板进行修改时，我总是最大限度的保证其兼容性。
如果``新的格式控制文件''产生的效果对你很有吸引力，那么不妨尝试一下。
应用新的格式控制文件是一件非常简单的事情：
你只要把原来的~sjtumaster-xetex.cls, sjtumaster-xetex.cfg, GBxxx.bst~覆盖(建议备份或者使用版本控制系统)，重新编译一遍，应该就OK了。


\section{获取帮助和意见反馈}
\label{sec:replay}

如果你对这个模板有任何问题或建议(前提是你认真读完这份文档后发现确实没有能帮助你的地方)，欢迎到水源TeX\_LaTeX版上发贴反馈。你的反馈将是我完善模板的动力！

如果你是~\TeX/\LaTeX~方面的专家，也可以直接给我发\href{mailto:wei.jianwen@gmail.com}{邮件}，一起讨论改善模板的方法。
邮件的主题请加上``latex''字样。此外，模板中的其他纰缪，也欢迎直接来信抱怨。
